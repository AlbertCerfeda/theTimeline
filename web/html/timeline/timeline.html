<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="../../styles/base.css">
    <link id="gen_style" rel="stylesheet" href="../../styles/timeline/base/style.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="../../script/jquery.visible.js"></script>
    <script type="text/javascript" src="../../script/sticky-kit.js"></script>

    <script type="text/javascript"  src="pageMapping.js"></script>

    <meta http-equiv='pragma' content='no-cache'>
</head>
<body>
<script>
    /*PAGE MAPPING USING JSON*/

    // // Contains the parsed 'pageMapping.json' file
    // var JSONobj;
    // //JSON file 'pageMapping.json' gets loaded into variable 'JSONobj'
    // function loadJSON() {
    //     var xobj = new XMLHttpRequest();
    //     xobj.overrideMimeType("application/json");
    //     xobj.open('GET', 'pageMapping.json', true);
    //     xobj.onreadystatechange = function () {
    //         if (xobj.readyState == 4 && xobj.status == "200") {
    //             //console.log(xobj.responseText);
    //             JSONobj = JSON.parse(xobj.responseText);
    //             delete JSONobj['-1'];
    //         }
    //     };
    //     xobj.send(null);
    // }
    // loadJSON();

    // Get the content from pageMapping.js
    var JSONobj = pages;
    // remove bad content
    delete JSONobj['-1'];
    // debug print the JSONobj
    console.debug(JSONobj);

    //CONTENT GENERATION FUNCTIONS
    /// NAVMENU GENERATION
    // Returns the generated navmenu content string
    function generateNavmenuContent(){
        var navmenu = "<tr>";

        //Returns the generated left pane string of the navmenu
        var generateLeftPane = function (){
            var leftPane = '<td id="leftpane"> <ul>';

            // For every generation a navmenu generation label is generated
            Object.keys(JSONobj).forEach(function (el,index){
                var genName = el;

                leftPane+=`<li class="navmenu-entry gen" href="${genName}">${genName}</li>`;

            });

            leftPane+='</ul></td>';
            return leftPane;
        }

        //Returns the generated right pane string of the navmenu
        var generateRightPane = function (){
            var rightPane = '<td id="rightpane">';

            // For every generation, an unordered list is generated
            Object.keys(JSONobj).forEach(function (el,index){
                var genName = el;
                rightPane+=`<ul class="${genName}">`;

                // For every page in the generation, a list item is generated
                JSONobj[el].pages.forEach(function (page){
                    rightPane+=`<li class="navmenu-entry page" href="${page.href}">${page.product}</li>`;
                });

                rightPane+='</ul>';

            });

            rightPane+='</td>';
            return rightPane;
        }

        navmenu+=generateLeftPane();
        navmenu+=generateRightPane();

        navmenu+="</tr>";
        return navmenu;
    }

    // Regenerates the navmenu content
    function refreshNavmenu(){
        // First it clears the content of the navmenu
        $("#navmenu").children().detach();
        // Then puts the generated navmenu content inside of it
        $("#navmenu").append(generateNavmenuContent());
    }

    /////////////////////
    /// TIMELINE GENERATION
    // Generates an event container placed either lef or right, depending on the boolean placedLeft input
    function generateEventContainer(page_jsonobj, generation, placedLeft){
        //TODO: This is utterly terrible. My naked grandma looks more attractive than this design.

        var placement;
        switch (placedLeft){
            case true:
                placement= "left";
                break;
            default:
                placement= "right";
                break;
        }

        var eventcontainer = `<div class="container ${placement}" id="${page_jsonobj.product}">
            <div class="content ${generation}">
                <h2>${page_jsonobj.date}</h2>
                <h4>${page_jsonobj.product}</h4>
                <p>${page_jsonobj.description}</p>
            </div>`

        eventcontainer+=`</div>`;
        return eventcontainer;
    }

    // Generates a timeline of a specific generation
    function generateTimeline(generation_key){
        var timeline=`
        <div class="generationLabel">
            ${generation_key}
        </div>`;

        timeline+=`<div class="timeline" id="${generation_key}">`;
        var placedLeft = true;
        JSONobj[generation_key].pages.forEach(function (page,index){
            console.log(page);
            timeline+=generateEventContainer(page, generation_key, placedLeft);
            placedLeft=!placedLeft;
        });

        timeline+=`</div> <!-- P*******o-->`;
        return timeline;
    }

    // Generates the full timeline, composed of the timelines of every generation
    function generateFullTimeline(){
        var fulltimeline="";
        Object.keys(JSONobj).forEach(function (gen,index){
            fulltimeline+=generateTimeline(gen);
        });
        return fulltimeline;
    }

    // Regenerates the full timeline
    function refreshTimeline(){
        // First it clears the content of the current fulltimeline
        $("#fulltimeline").children().detach();
        // Then puts the newly generated fulltimeline content inside of it
        $("#fulltimeline").append(generateFullTimeline());
    }
</script>


<div id="navbar">
theTimeline
    <div id="navmenu-toggle">
        navmenu
    </div>
    <table id="navmenu" class="collapsed">

        <!-- EXAMPLE CONTENT. THIS IS LATER OVERWRITTEN BY JAVASCRIPT BASED ON THE JSON FILE-->
        <tr>
            <td id="leftpane">
                <ul>
                    <li class="navmenu-entry gen" href="gen0">gen0</li>
                    <li class="navmenu-entry gen" href="gen1">gen1</li>
                    <li class="navmenu-entry gen" href="gen2">gen2</li>
                </ul>
            </td>
            <td id="rightpane">

                <ul class="gen0">
                    <li class="navmenu-entry page" href="../gen0_pong/pong.html">pong</li>
                    <li>pong</li>
                    <li>pong</li>
                    <li>pong</li>
                    <li>pong</li>
                </ul>

                <ul class="gen1">
                    <li class="navmenu-entry page" href="../gen1_pong/pong.html">pong</li>
                    <li>sda</li>
                    <li>sdf</li>
                    <li>sdf</li>
                    <li>sdf</li>
                </ul>

            </td>
        </tr>
        <!--##########################################################-->

    </table>
</div>
<div id="fulltimeline">

    <!--EXAMPLE CONTENT. THIS IS LATER OVERWRITTEN BY JAVASCRIPT BASED ON THE JSON FILE-->
    <div class="generationLabel" >
        gen0
    </div>
    <div class="timeline" id="gen0">
        <div class="container left">
            <div class="content">
                <h2>2017</h2>
                <p>Lorem ipsum dolor sit amet, quo ei simul congue exerci, ad nec admodum perfecto mnesarchum, vim ea mazim fierent detracto. Ea quis iuvaret expetendis his, te elit voluptua dignissim per, habeo iusto primis ea eam.</p>
            </div>
        </div>
        <div class="container right">
            <div class="content">
                <h2>2016</h2>
                <p>Lorem ipsum dolor sit amet, quo ei simul congue exerci, ad nec admodum perfecto mnesarchum, vim ea mazim fierent detracto. Ea quis iuvaret expetendis his, te elit voluptua dignissim per, habeo iusto primis ea eam.</p>
            </div>
        </div>
        <div class="container left">
            <div class="content">
                <h2>2015</h2>
                <p>Lorem ipsum dolor sit amet, quo ei simul congue exerci, ad nec admodum perfecto mnesarchum, vim ea mazim fierent detracto. Ea quis iuvaret expetendis his, te elit voluptua dignissim per, habeo iusto primis ea eam.</p>
            </div>
        </div>
        <div class="container right">
            <div class="content">
                <h2>2012</h2>
                <p>Lorem ipsum dolor sit amet, quo ei simul congue exerci, ad nec admodum perfecto mnesarchum, vim ea mazim fierent detracto. Ea quis iuvaret expetendis his, te elit voluptua dignissim per, habeo iusto primis ea eam.</p>
            </div>
        </div>
        <div class="container left">
            <div class="content">
                <h2>2011</h2>
                <p>Lorem ipsum dolor sit amet, quo ei simul congue exerci, ad nec admodum perfecto mnesarchum, vim ea mazim fierent detracto. Ea quis iuvaret expetendis his, te elit voluptua dignissim per, habeo iusto primis ea eam.</p>
            </div>
        </div>
        <div class="container right">
            <div class="content">
                <h2>2007</h2>
                <p>Lorem ipsum dolor sit amet, quo ei simul congue exerci, ad nec admodum perfecto mnesarchum, vim ea mazim fierent detracto. Ea quis iuvaret expetendis his, te elit voluptua dignissim per, habeo iusto primis ea eam.</p>
            </div>
        </div>
    </div>

    <div class="generationLabel" >
        gen1
    </div>
    <div class="timeline" id="gen1">
        <div class="container left">
            <div class="content">
                <h2>2017</h2>
                <p>Lorem ipsum dolor sit amet, quo ei simul congue exerci, ad nec admodum perfecto mnesarchum, vim ea mazim fierent detracto. Ea quis iuvaret expetendis his, te elit voluptua dignissim per, habeo iusto primis ea eam.</p>
            </div>
        </div>
        <div class="container right">
            <div class="content">
                <h2>2016</h2>
                <p>Lorem ipsum dolor sit amet, quo ei simul congue exerci, ad nec admodum perfecto mnesarchum, vim ea mazim fierent detracto. Ea quis iuvaret expetendis his, te elit voluptua dignissim per, habeo iusto primis ea eam.</p>
            </div>
        </div>
        <div class="container left">
            <div class="content">
                <h2>2015</h2>
                <p>Lorem ipsum dolor sit amet, quo ei simul congue exerci, ad nec admodum perfecto mnesarchum, vim ea mazim fierent detracto. Ea quis iuvaret expetendis his, te elit voluptua dignissim per, habeo iusto primis ea eam.</p>
            </div>
        </div>
        <div class="container right">
            <div class="content">
                <h2>2012</h2>
                <p>Lorem ipsum dolor sit amet, quo ei simul congue exerci, ad nec admodum perfecto mnesarchum, vim ea mazim fierent detracto. Ea quis iuvaret expetendis his, te elit voluptua dignissim per, habeo iusto primis ea eam.</p>
            </div>
        </div>
        <div class="container left">
            <div class="content">
                <h2>2011</h2>
                <p>Lorem ipsum dolor sit amet, quo ei simul congue exerci, ad nec admodum perfecto mnesarchum, vim ea mazim fierent detracto. Ea quis iuvaret expetendis his, te elit voluptua dignissim per, habeo iusto primis ea eam.</p>
            </div>
        </div>
        <div class="container right">
            <div class="content">
                <h2>2007</h2>
                <p>Lorem ipsum dolor sit amet, quo ei simul congue exerci, ad nec admodum perfecto mnesarchum, vim ea mazim fierent detracto. Ea quis iuvaret expetendis his, te elit voluptua dignissim per, habeo iusto primis ea eam.</p>
            </div>
        </div>
    </div >
    <!--##########################################################-->

</div>

<script>
    ///////////////////////////////////////////
    // TIMELINE FUNCTIONS
    // Collapses all the event containers inside a timeline by removing the .anim-in class.
    var collapseTimelineContent = function (timelineToCollapse){
        console.log("Removing class anim-in");
        //Removes class .anim-in from every .container element inside the timeline
        $(timelineToCollapse).children(".container").removeClass("anim-in");
    }

    // Toggles the collapse on a Timeline
    var toggleTimelineCollapse = function (timeline){
        console.log("Toggling timeline: " + timeline);
        switch ($(timeline).hasClass("collapsed")){
            // If the timeline was collapsed, it expands it
            case true:
                collapseTimeline(timeline, false);
                break;
            //If the timeline was expanded, it collapses it
            case false:
                collapseTimeline(timeline, true);
                break;
        }
    }

    // It expands/collapses a timeline based on 'collapse' boolean input false/true
    var collapseTimeline = function (timeline, collapse){
        console.log("Click registered");

        switch (collapse){
            //If 'collapse' is false, the timeline gets expanded
            case false:
                $(timeline).removeClass("collapsed");
                break;
            //If 'collapse' is true, the timeline gets collapsed
            case true:
                $(timeline).addClass("collapsed");
                collapseTimelineContent(timeline);
                break;
        }

        //Animates the visible containers after the expanding/collapsing of the timeline
        animateVisibleContainers();
    };

    //Animates every event container that is in the viewport of the browser by adding the .anim-in class.
    var animateVisibleContainers = function(){
        var visibleElements = $('.container:visible').filter(function(i, el) {
            return $(el).visible(true);
        });

        $.each(visibleElements,function(i, el) {
            var el = $(el);

            // For every visible element the class .anim-in gets added with a delay depending on the element number
            //   in order to make the containers animate one after the another
            setTimeout(function(){el.addClass("anim-in");}, 140 + (140*i));
        });
    }

    ///////////////////////////////////////////
    // NAVIGATION MENU FUNCTIONS
    // Switches the game list in the navigation menu based on a specific generation (genX)
    var switchNavmenuToGenX = function(genX){
        //The .active class gets added to the label in the navmenu associated with genX
        $.each($("li.navmenu-entry.gen"), function (){
            if ($(this).attr('href') == genX){
                console.log("Adding active");
                $(this).addClass("active");
            }else{
                //console.log("Removing active");
                $(this).removeClass("active");
            }
        });

        // Makes the game list of genX visible and the the rest hidden
        $.each($("#rightpane").children("ul"), function () {
            if ($(this).hasClass(genX)){
                $(this).show();
            }else{
                $(this).hide();
            }
        });
    }

    ///////////////////////////////////////////
    // Sets up all he event listeners
    var setupHandlers = function(){
        // When the window scroll, it checks if there are any containers to animate
        $(window).scroll(function(){animateVisibleContainers();});

        //When a generation label in the timeline gets clicked, it toggles the timeline associated to it
        $('.generationLabel').click(function(){toggleTimelineCollapse($(this).next());});

        // When the navmenu button gets clicked, the navmenu gets toggled
        $('#navmenu-toggle').click(function(){
            console.log("navmenu-toggle Click registered");
            $('#navmenu').toggleClass("collapsed");
        });

        // When a generation label in the navmenu gets clicked, the page scrolls to the specific generation timeline
        $('.navmenu-entry.gen').click(function (){
            console.log("Registered click on navmenu-entry(gen). Going to HREF: " + $(this).attr('href')+" ...");
            // The associated generation timeline gets expanded to make sure it's visible once it gets scrolled to
            collapseTimeline($(this).attr('href'), false);
            // The page scrolls to the timeline
            $('html, body').animate({
                scrollTop: ($('#'+$(this).attr('href')).offset().top)
            },500);
        });

        //When a generation label in the navmenu gets hovered, the game list gets switched
        $('.navmenu-entry.gen').hover(function (){
            console.log("Registered hover on navmenu-entry(gen). Showing list for generation " + $(this).attr('href')+" ...");
            switchNavmenuToGenX($(this).attr('href'));
        });

        // When a game entry in the navbar gets clicked, the browser gets redirected to its page
        $('.navmenu-entry.page').click(function (){
            console.log("Registered click on navmenu-entry(page). Going to HREF: " + $(this).attr('href')+" ...");
            window.location.href = $(this).attr('href');
        });


    }

    $(document).ready(function(){
        //The navmenu gets generated based on the contents of 'pageMapping.json'
        refreshNavmenu();
        // The full timeline gets generated based on the contents of 'pageMapping.json'
        refreshTimeline();

        // Adds the listeners
        setupHandlers();

        //Makes the navigation menu be set do display by default the first generation
        switchNavmenuToGenX($(".navmenu-entry.gen").first().attr('href'));

        animateVisibleContainers();
    });
</script>

</body>
</html>
